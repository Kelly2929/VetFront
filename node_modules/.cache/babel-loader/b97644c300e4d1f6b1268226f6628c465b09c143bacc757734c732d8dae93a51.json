{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Moshe\\\\Downloads\\\\VetChat (1)\\\\VetChat\\\\frontend\\\\src\\\\context\\\\AuthContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { createContext, useContext, useState, useEffect } from \"react\";\nimport axios from \"axios\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AuthContext = /*#__PURE__*/createContext();\nexport function useAuth() {\n  _s();\n  return useContext(AuthContext);\n}\n_s(useAuth, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nexport function AuthProvider({\n  children\n}) {\n  _s2();\n  const [currentUser, setCurrentUser] = useState(null);\n  const [currentUserToken, setCurrentUserToken] = useState(null);\n  const [loading, setLoading] = useState(true);\n  async function login(email, password) {\n    try {\n      const response = await axios.post(\"http://localhost:8080/api/users/signin\", {\n        email,\n        password\n      });\n      setCurrentUser(response.data);\n      setCurrentUserToken(response.data.token);\n      sessionStorage.setItem(\"token\", response.data.token); // Assuming the server responds with a token\n      axios.defaults.headers.common[\"Authorization\"] = `Bearer ${response.data.token}`;\n      window.location.reload();\n      return response.data; // This can be useful to confirm successful login in the calling component\n    } catch (error) {\n      // Here you can handle errors, for example:\n      // If the API call was unsuccessful, you might want to show an error message\n      console.error(\"Login failed:\", error.response ? error.response.data : error.message);\n      throw error; // Re-throw the error if you want to handle it further up the call stack (e.g., to display an error message in the UI)\n    }\n  }\n  function logout() {\n    setCurrentUser(null);\n    sessionStorage.removeItem(\"token\");\n    delete axios.defaults.headers.common[\"Authorization\"];\n    window.location.reload();\n  }\n  async function register(emailParam, password, nameParam, isVetParam) {\n    try {\n      const response = await axios.post(\"http://localhost:8080/api/users/signup\", {\n        email: emailParam,\n        password,\n        name: nameParam,\n        isVet: isVetParam\n      });\n\n      // Assuming the response.data.data contains the user details and token\n      const {\n        userId,\n        name,\n        email,\n        isVet,\n        token\n      } = response.data;\n      // Create a user object that includes the necessary details\n      const user = {\n        id: userId,\n        name: name,\n        email: email,\n        isVet: isVet\n      };\n      setCurrentUser(user); // Set the current user with the user object\n      setCurrentUserToken(token); // Set the current user's token\n      sessionStorage.setItem(\"token\", token); // Store the token in sessionStorage\n      axios.defaults.headers.common[\"Authorization\"] = `Bearer ${token}`; // Set the authorization header for subsequent requests\n      window.location.reload();\n      return response.data; // Return the full response data for further processing if needed\n    } catch (error) {\n      console.error(\"Registration failed:\", error.response ? error.response.data : error.message);\n      throw error; // Re-throw the error for handling in UI components\n    }\n  }\n  async function loadUserFromToken() {\n    const token = sessionStorage.getItem(\"token\");\n    if (token) {\n      axios.defaults.headers.common[\"Authorization\"] = `Bearer ${token}`;\n      try {\n        const response = await axios.get(\"http://localhost:8080/api/users/me\");\n        setCurrentUserToken(response.data.token);\n        setCurrentUser(response.data.user);\n      } catch (error) {\n        console.error(\"Failed to load user from token:\", error);\n        logout();\n      } finally {\n        setLoading(false);\n      }\n    } else {\n      setLoading(false);\n    }\n  }\n  useEffect(() => {\n    loadUserFromToken();\n  }, []);\n  const value = {\n    currentUser,\n    currentUserToken,\n    login,\n    logout,\n    register\n  };\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: value,\n    children: !loading && children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 115,\n    columnNumber: 5\n  }, this);\n}\n_s2(AuthProvider, \"SlkATXt29kO5h/DRC63MZsItbyo=\");\n_c = AuthProvider;\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","axios","jsxDEV","_jsxDEV","AuthContext","useAuth","_s","AuthProvider","children","_s2","currentUser","setCurrentUser","currentUserToken","setCurrentUserToken","loading","setLoading","login","email","password","response","post","data","token","sessionStorage","setItem","defaults","headers","common","window","location","reload","error","console","message","logout","removeItem","register","emailParam","nameParam","isVetParam","name","isVet","userId","user","id","loadUserFromToken","getItem","get","value","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Users/Moshe/Downloads/VetChat (1)/VetChat/frontend/src/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect } from \"react\";\r\nimport axios from \"axios\";\r\n\r\nconst AuthContext = createContext();\r\n\r\nexport function useAuth() {\r\n  return useContext(AuthContext);\r\n}\r\n\r\nexport function AuthProvider({ children }) {\r\n  const [currentUser, setCurrentUser] = useState(null);\r\n  const [currentUserToken, setCurrentUserToken] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  async function login(email, password) {\r\n    try {\r\n      const response = await axios.post(\r\n        \"http://localhost:8080/api/users/signin\",\r\n        { email, password }\r\n      );\r\n\r\n      setCurrentUser(response.data);\r\n      setCurrentUserToken(response.data.token);\r\n      sessionStorage.setItem(\"token\", response.data.token); // Assuming the server responds with a token\r\n      axios.defaults.headers.common[\r\n        \"Authorization\"\r\n      ] = `Bearer ${response.data.token}`;\r\n      window.location.reload();\r\n      return response.data; // This can be useful to confirm successful login in the calling component\r\n    } catch (error) {\r\n      // Here you can handle errors, for example:\r\n      // If the API call was unsuccessful, you might want to show an error message\r\n      console.error(\r\n        \"Login failed:\",\r\n        error.response ? error.response.data : error.message\r\n      );\r\n      throw error; // Re-throw the error if you want to handle it further up the call stack (e.g., to display an error message in the UI)\r\n    }\r\n  }\r\n\r\n  function logout() {\r\n    setCurrentUser(null);\r\n    sessionStorage.removeItem(\"token\");\r\n    delete axios.defaults.headers.common[\"Authorization\"];\r\n    window.location.reload();\r\n  }\r\n\r\n  async function register(emailParam, password, nameParam, isVetParam) {\r\n    try {\r\n      const response = await axios.post(\r\n        \"http://localhost:8080/api/users/signup\",\r\n        { email:emailParam, password, name:nameParam, isVet:isVetParam }\r\n      );\r\n  \r\n      // Assuming the response.data.data contains the user details and token\r\n      const { userId, name, email, isVet, token } = response.data  \r\n      // Create a user object that includes the necessary details\r\n      const user = {\r\n        id: userId,\r\n        name: name,\r\n        email: email,\r\n        isVet: isVet\r\n      };\r\n  \r\n      setCurrentUser(user); // Set the current user with the user object\r\n      setCurrentUserToken(token); // Set the current user's token\r\n      sessionStorage.setItem(\"token\", token); // Store the token in sessionStorage\r\n      axios.defaults.headers.common[\"Authorization\"] = `Bearer ${token}`; // Set the authorization header for subsequent requests\r\n      window.location.reload();\r\n      return response.data; // Return the full response data for further processing if needed\r\n    } catch (error) {\r\n      console.error(\r\n        \"Registration failed:\",\r\n        error.response ? error.response.data : error.message\r\n      );\r\n      throw error; // Re-throw the error for handling in UI components\r\n    }\r\n  }\r\n  \r\n\r\n  async function loadUserFromToken() {\r\n    const token = sessionStorage.getItem(\"token\");\r\n    if (token) {\r\n      axios.defaults.headers.common[\"Authorization\"] = `Bearer ${token}`;\r\n      try {\r\n        const response = await axios.get(\"http://localhost:8080/api/users/me\");\r\n\r\n        setCurrentUserToken(response.data.token);\r\n        setCurrentUser(response.data.user);\r\n      } catch (error) {\r\n        console.error(\"Failed to load user from token:\", error);\r\n        logout();\r\n      } finally { \r\n        \r\n        setLoading(false);\r\n      }\r\n    } else {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    loadUserFromToken();\r\n  }, []);\r\n\r\n  const value = {\r\n    currentUser,\r\n    currentUserToken,\r\n    login,\r\n    logout,\r\n    register,\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={value}>\r\n      {!loading && children}\r\n    </AuthContext.Provider>\r\n  );\r\n}\r\n"],"mappings":";;;AAAA,OAAOA,KAAK,IAAIC,aAAa,EAAEC,UAAU,EAAEC,QAAQ,EAAEC,SAAS,QAAQ,OAAO;AAC7E,OAAOC,KAAK,MAAM,OAAO;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAE1B,MAAMC,WAAW,gBAAGP,aAAa,CAAC,CAAC;AAEnC,OAAO,SAASQ,OAAOA,CAAA,EAAG;EAAAC,EAAA;EACxB,OAAOR,UAAU,CAACM,WAAW,CAAC;AAChC;AAACE,EAAA,CAFeD,OAAO;AAIvB,OAAO,SAASE,YAAYA,CAAC;EAAEC;AAAS,CAAC,EAAE;EAAAC,GAAA;EACzC,MAAM,CAACC,WAAW,EAAEC,cAAc,CAAC,GAAGZ,QAAQ,CAAC,IAAI,CAAC;EACpD,MAAM,CAACa,gBAAgB,EAAEC,mBAAmB,CAAC,GAAGd,QAAQ,CAAC,IAAI,CAAC;EAC9D,MAAM,CAACe,OAAO,EAAEC,UAAU,CAAC,GAAGhB,QAAQ,CAAC,IAAI,CAAC;EAE5C,eAAeiB,KAAKA,CAACC,KAAK,EAAEC,QAAQ,EAAE;IACpC,IAAI;MACF,MAAMC,QAAQ,GAAG,MAAMlB,KAAK,CAACmB,IAAI,CAC/B,wCAAwC,EACxC;QAAEH,KAAK;QAAEC;MAAS,CACpB,CAAC;MAEDP,cAAc,CAACQ,QAAQ,CAACE,IAAI,CAAC;MAC7BR,mBAAmB,CAACM,QAAQ,CAACE,IAAI,CAACC,KAAK,CAAC;MACxCC,cAAc,CAACC,OAAO,CAAC,OAAO,EAAEL,QAAQ,CAACE,IAAI,CAACC,KAAK,CAAC,CAAC,CAAC;MACtDrB,KAAK,CAACwB,QAAQ,CAACC,OAAO,CAACC,MAAM,CAC3B,eAAe,CAChB,GAAI,UAASR,QAAQ,CAACE,IAAI,CAACC,KAAM,EAAC;MACnCM,MAAM,CAACC,QAAQ,CAACC,MAAM,CAAC,CAAC;MACxB,OAAOX,QAAQ,CAACE,IAAI,CAAC,CAAC;IACxB,CAAC,CAAC,OAAOU,KAAK,EAAE;MACd;MACA;MACAC,OAAO,CAACD,KAAK,CACX,eAAe,EACfA,KAAK,CAACZ,QAAQ,GAAGY,KAAK,CAACZ,QAAQ,CAACE,IAAI,GAAGU,KAAK,CAACE,OAC/C,CAAC;MACD,MAAMF,KAAK,CAAC,CAAC;IACf;EACF;EAEA,SAASG,MAAMA,CAAA,EAAG;IAChBvB,cAAc,CAAC,IAAI,CAAC;IACpBY,cAAc,CAACY,UAAU,CAAC,OAAO,CAAC;IAClC,OAAOlC,KAAK,CAACwB,QAAQ,CAACC,OAAO,CAACC,MAAM,CAAC,eAAe,CAAC;IACrDC,MAAM,CAACC,QAAQ,CAACC,MAAM,CAAC,CAAC;EAC1B;EAEA,eAAeM,QAAQA,CAACC,UAAU,EAAEnB,QAAQ,EAAEoB,SAAS,EAAEC,UAAU,EAAE;IACnE,IAAI;MACF,MAAMpB,QAAQ,GAAG,MAAMlB,KAAK,CAACmB,IAAI,CAC/B,wCAAwC,EACxC;QAAEH,KAAK,EAACoB,UAAU;QAAEnB,QAAQ;QAAEsB,IAAI,EAACF,SAAS;QAAEG,KAAK,EAACF;MAAW,CACjE,CAAC;;MAED;MACA,MAAM;QAAEG,MAAM;QAAEF,IAAI;QAAEvB,KAAK;QAAEwB,KAAK;QAAEnB;MAAM,CAAC,GAAGH,QAAQ,CAACE,IAAI;MAC3D;MACA,MAAMsB,IAAI,GAAG;QACXC,EAAE,EAAEF,MAAM;QACVF,IAAI,EAAEA,IAAI;QACVvB,KAAK,EAAEA,KAAK;QACZwB,KAAK,EAAEA;MACT,CAAC;MAED9B,cAAc,CAACgC,IAAI,CAAC,CAAC,CAAC;MACtB9B,mBAAmB,CAACS,KAAK,CAAC,CAAC,CAAC;MAC5BC,cAAc,CAACC,OAAO,CAAC,OAAO,EAAEF,KAAK,CAAC,CAAC,CAAC;MACxCrB,KAAK,CAACwB,QAAQ,CAACC,OAAO,CAACC,MAAM,CAAC,eAAe,CAAC,GAAI,UAASL,KAAM,EAAC,CAAC,CAAC;MACpEM,MAAM,CAACC,QAAQ,CAACC,MAAM,CAAC,CAAC;MACxB,OAAOX,QAAQ,CAACE,IAAI,CAAC,CAAC;IACxB,CAAC,CAAC,OAAOU,KAAK,EAAE;MACdC,OAAO,CAACD,KAAK,CACX,sBAAsB,EACtBA,KAAK,CAACZ,QAAQ,GAAGY,KAAK,CAACZ,QAAQ,CAACE,IAAI,GAAGU,KAAK,CAACE,OAC/C,CAAC;MACD,MAAMF,KAAK,CAAC,CAAC;IACf;EACF;EAGA,eAAec,iBAAiBA,CAAA,EAAG;IACjC,MAAMvB,KAAK,GAAGC,cAAc,CAACuB,OAAO,CAAC,OAAO,CAAC;IAC7C,IAAIxB,KAAK,EAAE;MACTrB,KAAK,CAACwB,QAAQ,CAACC,OAAO,CAACC,MAAM,CAAC,eAAe,CAAC,GAAI,UAASL,KAAM,EAAC;MAClE,IAAI;QACF,MAAMH,QAAQ,GAAG,MAAMlB,KAAK,CAAC8C,GAAG,CAAC,oCAAoC,CAAC;QAEtElC,mBAAmB,CAACM,QAAQ,CAACE,IAAI,CAACC,KAAK,CAAC;QACxCX,cAAc,CAACQ,QAAQ,CAACE,IAAI,CAACsB,IAAI,CAAC;MACpC,CAAC,CAAC,OAAOZ,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,iCAAiC,EAAEA,KAAK,CAAC;QACvDG,MAAM,CAAC,CAAC;MACV,CAAC,SAAS;QAERnB,UAAU,CAAC,KAAK,CAAC;MACnB;IACF,CAAC,MAAM;MACLA,UAAU,CAAC,KAAK,CAAC;IACnB;EACF;EAEAf,SAAS,CAAC,MAAM;IACd6C,iBAAiB,CAAC,CAAC;EACrB,CAAC,EAAE,EAAE,CAAC;EAEN,MAAMG,KAAK,GAAG;IACZtC,WAAW;IACXE,gBAAgB;IAChBI,KAAK;IACLkB,MAAM;IACNE;EACF,CAAC;EAED,oBACEjC,OAAA,CAACC,WAAW,CAAC6C,QAAQ;IAACD,KAAK,EAAEA,KAAM;IAAAxC,QAAA,EAChC,CAACM,OAAO,IAAIN;EAAQ;IAAA0C,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACD,CAAC;AAE3B;AAAC5C,GAAA,CA7GeF,YAAY;AAAA+C,EAAA,GAAZ/C,YAAY;AAAA,IAAA+C,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}